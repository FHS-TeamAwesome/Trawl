

/**
 * Facebook Photos Schema
 {
   "data": [
     {
       "images": [
         {
           "height": 1080,
           "source": "https://scontent.xx.fbcdn.net/v/t31.0-8/14884500_353970868271330_724041770318380050_o.jpg?oh=5a0d6270202844f007f82c27507f109b&oe=58E0F219",
           "width": 1080
         },
         {
           "height": 960,
           "source": "https://scontent.xx.fbcdn.net/v/t1.0-9/14908327_353970868271330_724041770318380050_n.jpg?oh=656e58d876a7e1058a337504dad5d75d&oe=58E14B05",
           "width": 960
         },
         {
           "height": 720,
           "source": "https://scontent.xx.fbcdn.net/v/t1.0-9/p720x720/14908327_353970868271330_724041770318380050_n.jpg?oh=91ca13cce5e1003ac39c24cbd7586d1f&oe=58EE1DF4",
           "width": 720
         },
         {
           "height": 600,
           "source": "https://scontent.xx.fbcdn.net/v/t1.0-0/p600x600/14908327_353970868271330_724041770318380050_n.jpg?oh=83df1a7bcfae1bf11a4ed768eb33dd87&oe=5920C6D7",
           "width": 600
         },
         {
           "height": 480,
           "source": "https://scontent.xx.fbcdn.net/v/t1.0-0/p480x480/14908327_353970868271330_724041770318380050_n.jpg?oh=2c00455759af61b1cddf3d839edcbb8f&oe=58E161CF",
           "width": 480
         },
         {
           "height": 320,
           "source": "https://scontent.xx.fbcdn.net/v/t1.0-0/p320x320/14908327_353970868271330_724041770318380050_n.jpg?oh=684b7bf2e089e3891dc45afc37987877&oe=58ED4193",
           "width": 320
         },
         {
           "height": 540,
           "source": "https://scontent.xx.fbcdn.net/v/t1.0-0/p180x540/14908327_353970868271330_724041770318380050_n.jpg?oh=7f0166ae77a732e057febc70fa053065&oe=58EB2BE5",
           "width": 540
         },
         {
           "height": 130,
           "source": "https://scontent.xx.fbcdn.net/v/t1.0-0/p130x130/14908327_353970868271330_724041770318380050_n.jpg?oh=2a217ebefe810050ddd4c2c720e6c74e&oe=58D9F803",
           "width": 130
         },
         {
           "height": 225,
           "source": "https://scontent.xx.fbcdn.net/v/t1.0-0/p75x225/14908327_353970868271330_724041770318380050_n.jpg?oh=9119af47694de9a1389309f63a08432d&oe=59192931",
           "width": 225
         }
       ],
       "created_time": "2016-11-01T01:08:35+0000",
       "id": "353970868271330"
     },
     {
       "images": [
         {
           "height": 1356,
           "source": "https://scontent.xx.fbcdn.net/v/t31.0-8/14361181_332675483734202_2536518491176658396_o.jpg?oh=c63268fa43557e2b61481801f1d8546c&oe=58D995D6",
           "width": 2048
         },
         {
           "height": 960,
           "source": "https://scontent.xx.fbcdn.net/v/t31.0-8/q83/p960x960/14361181_332675483734202_2536518491176658396_o.jpg?oh=edcd59702f0c12839c293f29fadd458b&oe=59198870",
           "width": 1449
         },
         {
           "height": 720,
           "source": "https://scontent.xx.fbcdn.net/v/t31.0-8/q83/p720x720/14361181_332675483734202_2536518491176658396_o.jpg?oh=187711795cc93ec1a426a6d8f743f8b0&oe=58E4AAD1",
           "width": 1087
         },
         {
           "height": 600,
           "source": "https://scontent.xx.fbcdn.net/v/t31.0-0/p600x600/14361181_332675483734202_2536518491176658396_o.jpg?oh=9f1453604e34c569f1cbb5f6713aa136&oe=58E02945",
           "width": 906
         },
         {
           "height": 480,
           "source": "https://scontent.xx.fbcdn.net/v/t31.0-0/p480x480/14361181_332675483734202_2536518491176658396_o.jpg?oh=cc2beee0686ea42908a3049d8a2b8799&oe=58DF0CA5",
           "width": 724
         },
         {
           "height": 320,
           "source": "https://scontent.xx.fbcdn.net/v/t1.0-0/p320x320/14355055_332675483734202_2536518491176658396_n.jpg?oh=17c087bf17bfc4fab83c5fe929619d1e&oe=5923A540",
           "width": 483
         },
         {
           "height": 540,
           "source": "https://scontent.xx.fbcdn.net/v/t31.0-0/p180x540/14361181_332675483734202_2536518491176658396_o.jpg?oh=668cfa4612ee0ee84d64870f0cb15ad4&oe=58E14542",
           "width": 815
         },
         {
           "height": 130,
           "source": "https://scontent.xx.fbcdn.net/v/t1.0-0/p130x130/14355055_332675483734202_2536518491176658396_n.jpg?oh=17fa120604e490a3219a0e58d180a1bd&oe=58E1E72F",
           "width": 196
         },
         {
           "height": 225,
           "source": "https://scontent.xx.fbcdn.net/v/t1.0-0/p75x225/14355055_332675483734202_2536518491176658396_n.jpg?oh=a5745dcbb1ed2571bfb780ff7f70a45d&oe=591A5E5B",
           "width": 340
         }
       ],
       "place": {
         "name": "Carrer De La Creu Coberta",
         "location": {
           "city": "Barcelona",
           "country": "Spain",
           "latitude": 41.375239458645,
           "longitude": 2.147571575352
         },
         "id": "472605446106074"
       },
       "created_time": "2016-09-20T08:54:08+0000",
       "id": "332675483734202"
     }
  **/

'use strict';

import config from 'config';
import Collection from 'core/collection';
import Photo from 'facebook/photo';

const IMAGE_SIZE_IDX = 0;

module.exports = Collection.extend({
    model: Photo,

    accessToken: null,

    reqDataType: 'jsonp',

    initialize(accessToken) {
        this.accessToken = accessToken;
    },

    url() {
        return config.get('Client.providers.facebook.api') + '/me/photos?fields=images,place,created_time&type=uploaded&limit=500&access_token=' + this.accessToken;
    },

    parse(data) {

        if (!data) return {};

        let photoArr = [];

        for (let image of data.data){
            let photo;
            let photoData = {
                id: image.id,
                url: image.images[IMAGE_SIZE_IDX].source,
                created_time: image.created_time
            };
            if (image.place) {
                photoData.locationName = image.place.name;
                photoData.latitude = image.place.location.latitude;
                photoData.longitude = image.place.location.longitude;
            }

            photoArr.push(new Photo(photoData));

        }

        return photoArr;
    },

    getPhotosWithLocation() {
        let photoArr = [];

        for (let photo of this.models) {
            if (photo.get('locationName') !== null) {
                photoArr.push(photo.toJSON());
            }
        }

        return photoArr;
    },

    getActivities() {
        let activities = [];

        for (let photo of this.models) {

            let activity = {
                id: photo.id,
                type: 'photo',
                created_time: photo.getCreateDate(),
                provider: 'facebook'
            };

            activities.push(activity);
        }

        return activities;
    }
});