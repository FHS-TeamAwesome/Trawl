<!DOCTYPE html>
<html>
    <head>
        <title>
            Prototype
        </title>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script type="text/javascript">

          $('document').ready( function() {

            window.fbAsyncInit = function() { 

              FB.init({
                appId      : '722531051233683',
                xfbml      : true,
                version    : 'v2.8'
              });

              FB.AppEvents.logPageView();

              $('.login').on('click', function() {

                FB.login(function(response){

                }, {scope: 'manage_pages'}
                );

                FB.getLoginStatus(function(response) {

                  statusChangeCallback(response);

                });

                function statusChangeCallback(response) {

                  console.log('statusChangeCallback');
                  console.log(response);
                  
                  if (response.status === 'connected') {
                    let accessToken = response.authResponse.accessToken;

                    firstAPIQuery(accessToken);
                    
                  } 
                  else if (response.status === 'not_authorized') {
                    
                    document.getElementById('status').innerHTML = 'Please log ' +
                      'into this app.';
                  } 
                  else {
                    
                    document.getElementById('status').innerHTML = 'Please log ' +
                      'into Facebook.';
                  }
                };
              });
            };
              
              (function(d, s, id) {
               var js, fjs = d.getElementsByTagName(s)[0];
               if (d.getElementById(id)) {return;}
               js = d.createElement(s); js.id = id;
               js.src = "http://connect.facebook.net/en_US/sdk.js";
               fjs.parentNode.insertBefore(js, fjs);
             }(document, 'script', 'facebook-jssdk'));
          });  

          function firstAPIQuery(accessToken){
            let result;
            let newresult;

            console.log(accessToken);

            FB.api(
              "/me?fields=likes.limit(500)&access_token="+accessToken+"",

              redirect=false,
              
              function (response) {

                console.log(response);

                if (response && !response.error) {



                  result = response.likes.data;

                  for (var i = result.length - 1; i >= 0; i--) {
                    $('#prototype').prepend('<p>"'+result[i].name+'"<p/>');
                  }  
                }
              }
            );
          }  //additional permissions
        </script>
    </head>
    <body>
        <div id="prototype">
            Meine Likes: 
        </div>
        <button class="login">Login with Facebook</button>
    </body>
</html>
